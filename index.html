<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>stz – plan.html プレビュー</title>
  <meta name="description" content="plan.html を埋め込みでプレビューし、ワンクリックで全画面や新規タブ表示もできるインデックスページ。" />
  <style>
    :root{
      --brand:#0A2463; /* ブランドカラー */
      --bg:#f8fafc;
      --text:#0f172a;
      --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      background:var(--bg); color:var(--text);
    }
    .header{
      position:sticky; top:0; z-index:10;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:12px 16px; background:var(--brand); color:#fff;
      box-shadow: 0 2px 8px rgba(0,0,0,.15);
    }
    .title{margin:0; font-size:18px; font-weight:600;}
    .toolbar{display:flex; gap:8px; flex-wrap:wrap}
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.35);
      background: rgba(255,255,255,.15); color:#fff;
      padding:8px 12px; border-radius:12px; font-size:14px; cursor:pointer;
      transition: background .2s, transform .02s;
    }
    .btn:hover{ background: rgba(255,255,255,.25); }
    .btn:active{ transform: translateY(1px); }
    .btn--primary{ background:#fff; color:var(--brand); border-color:#fff; }
    .main{ height: calc(100vh - 60px); padding:12px; }
    .viewer{
      position:relative; width:100%; height:100%;
      border:1px solid var(--border); border-radius:16px; overflow:hidden; background:#fff;
      box-shadow: 0 8px 24px rgba(2,6,23,.06);
    }
    .viewer iframe{
      width:100%; height:100%; border:0; display:block;
      background:#fff;
    }
    .status{
      position:absolute; inset:auto 12px 12px auto;
      background:rgba(0,0,0,.05); color:#111; padding:4px 8px; border-radius:8px; font-size:12px;
    }
    @media (max-width: 640px){
      .main{ height: calc(100vh - 56px); padding:8px; }
      .title{ font-size:16px; }
    }
  </style>
</head>
<body>
  <header class="header" role="banner">
    <h1 class="title">stz / plan.html プレビュー</h1>
    <nav class="toolbar" aria-label="ビュー操作">
      <a class="btn btn--primary" href="./plan.html" target="_blank" rel="noopener">新しいタブで開く</a>
      <button class="btn" id="reloadBtn" type="button">再読み込み</button>
      <button class="btn" id="fsBtn" type="button" aria-pressed="false">全画面切替</button>
    </nav>
  </header>

  <main class="main" role="main">
    <div class="viewer" id="viewer">
      <iframe id="slideFrame" src="./plan.html" title="plan.html の埋め込みプレビュー" loading="eager" referrerpolicy="no-referrer-when-downgrade"></iframe>
      <div class="status" id="status" aria-live="polite">読み込み中…</div>
      <noscript>JavaScriptを有効にすると全画面/再読み込みボタンが使えます。</noscript>
    </div>
  </main>

  <script>
    (function(){
      const frame = document.getElementById('slideFrame');
      const status = document.getElementById('status');
      const viewer = document.getElementById('viewer');
      const reloadBtn = document.getElementById('reloadBtn');
      const fsBtn = document.getElementById('fsBtn');

      // 読み込み状態の表示
      let loadedOnce = false;
      frame.addEventListener('load', () => {
        loadedOnce = true;
        status.textContent = '読み込み完了';
        setTimeout(()=> status.style.display = 'none', 800);
      }, { once:false });

      // タイムアウトで簡易エラーハンドリング
      setTimeout(() => {
        if (!loadedOnce) status.textContent = 'plan.html を読み込んでいます…（パスとファイル名を確認）';
      }, 1500);

      // 再読み込み
      reloadBtn.addEventListener('click', () => {
        status.style.display = 'inline-block';
        status.textContent = '再読み込み中…';
        try {
          // 同一オリジンなので contentWindow.reload が基本使える
          if (frame.contentWindow && frame.contentWindow.location) {
            frame.contentWindow.location.reload();
          } else {
            frame.src = frame.src; // フォールバック
          }
        } catch (e) {
          frame.src = frame.src;
        }
      });

      // 全画面切替
      const enterFS = el => (el.requestFullscreen||el.webkitRequestFullscreen||el.msRequestFullscreen||el.mozRequestFullScreen)?.call(el);
      const exitFS  = doc => (doc.exitFullscreen||doc.webkitExitFullscreen||doc.msExitFullscreen||doc.mozCancelFullScreen)?.call(doc);

      fsBtn.addEventListener('click', () => {
        const doc = document;
        const inFs = !!(doc.fullscreenElement || doc.webkitFullscreenElement || doc.msFullscreenElement || doc.mozFullScreenElement);
        if (!inFs) {
          enterFS(viewer);
        } else {
          exitFS(doc);
        }
      });

      // ボタンのアクセシビリティ更新
      ['fullscreenchange','webkitfullscreenchange','msfullscreenchange','mozfullscreenchange'].forEach(ev=>{
        document.addEventListener(ev, () => {
          const inFs = !!(document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement || document.mozFullScreenElement);
          fsBtn.setAttribute('aria-pressed', String(inFs));
          fsBtn.textContent = inFs ? '全画面を終了' : '全画面切替';
        });
      });
    })();
  </script>
</body>
</html>
