/* ======== iPhone縦長レイアウト（完全修正） ======== */
:root{
  --brand:#0A2463;
  --bg:#f5f7fb;
  --ink:#1f2937;
  --muted:#4b5563;
  --card:#ffffff;
  --radius:14px;
  --safe-top: env(safe-area-inset-top);
  --safe-bottom: env(safe-area-inset-bottom);
}
*{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
html,body{ height:100%; }
body{
  margin:0; padding:0;
  font-family:'Noto Sans JP',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg); color:var(--ink);
  -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
}

/* ヘッダー（最小・固定） */
.appbar{
  position:sticky; top:0; z-index:50;
  padding:calc(8px + var(--safe-top)) 14px 8px 14px;
  background:#fff; border-bottom:1px solid #e5e7eb;
  display:flex; align-items:center; justify-content:space-between; gap:8px;
}
.brand{ display:flex; align-items:center; gap:8px; min-width:0; }
.brand-dot{ width:10px; height:10px; border-radius:50%; background:var(--brand); flex:0 0 auto; }
.brand-title{ font-weight:700; color:var(--brand); font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.app-actions{ display:flex; align-items:center; gap:8px; }
.icon-btn{
  border:none; background:var(--brand); color:#fff; border-radius:10px;
  padding:8px 10px; font-size:14px;
}
.counter{ font-weight:600; color:#374151; font-size:13px; padding:4px 10px; background:#eef2f7; border-radius:999px; }

/* 進捗バー（上部） */
.progress{
  position:sticky; top:44px; z-index:49; height:3px; width:100%;
  background:linear-gradient(90deg, var(--brand) var(--pct,0%), #e5e7eb var(--pct,0%));
}

/* 縦スクロール・スナップ */
.deck{
  height:100svh; /* iOS対応：小さいビューポート */
  overflow-y:auto;
  scroll-snap-type:y mandatory;
  -webkit-overflow-scrolling:touch;
}
.slide{
  scroll-snap-align:start;
  min-height:100svh;
  display:flex; padding:14px; padding-bottom:calc(16px + var(--safe-bottom));
}
.slide-container{
  background:var(--card); border-radius:var(--radius);
  box-shadow:0 10px 24px rgba(0,0,0,0.07);
  display:flex; flex-direction:column; width:100%;
  overflow:hidden;
}
.header-bar{ height:6px; width:100%; background:var(--brand); }
.content-wrapper{ flex:1; display:flex; flex-direction:column; padding:18px 16px 16px 16px; gap:14px; }
.title-section{ display:flex; align-items:center; gap:10px; }
.title-line{ width:26px; height:3px; background:var(--brand); border-radius:2px; }
.slide-title{ color:var(--brand); font-weight:700; font-size:clamp(18px, 4.6vw, 24px); line-height:1.25; }
.footer-section{ margin-top:auto; padding-top:10px; border-top:1px solid #edf2f7; color:#6b7280; font-size:12px; }

/* カード／ブロック */
.block{
  background:#f8fafc; border:1px solid #e5e7eb; border-radius:10px; padding:12px;
}
.muted{ color:var(--muted); }
.chip{ display:inline-flex; align-items:center; gap:6px; background:rgba(10,36,99,.06); border-left:4px solid var(--brand); padding:10px 12px; border-radius:8px; font-size:14px; color:#2d3748; }

/* 表（横スクロール） */
.table-wrap{ overflow:auto; -webkit-overflow-scrolling:touch; border-radius:10px; border:1px solid #e5e7eb; background:#fff; }
table{ border-collapse:separate; border-spacing:0; width:100%; }
thead th{ position:sticky; top:0; background:var(--brand); color:#fff; font-weight:600; font-size:13px; padding:10px; white-space:nowrap; }
tbody td{ padding:10px; font-size:13px; white-space:nowrap; }
tbody tr:nth-child(odd){ background:#fafafa; }

/* チャート領域（モバイル向け高さ） */
.chart{ width:100%; height:280px; }
@media (min-width:480px){
  .chart{ height:320px; }
}
/* iOS Safari: canvasサイズ0対策（親がflex/scroll-snap時に発生） */
.chart canvas{
  display:block;
  width:100% !important;
  height:100% !important;
}

/* フローティングナビ（上下） */
.fab{
  position:fixed; right:12px; bottom:calc(16px + var(--safe-bottom));
  display:flex; flex-direction:column; gap:10px; z-index:60;
}
.fab button{
  width:44px; height:44px; border-radius:12px; border:none; color:#fff; background:var(--brand);
  box-shadow:0 8px 16px rgba(10,36,99,0.25);
  display:flex; align-items:center; justify-content:center; font-size:18px;
}

/* TOC（全画面オーバーレイ） */
.toc{ position:fixed; inset:0; z-index:70; display:none; background:rgba(0,0,0,0.35); }
.toc-panel{
  position:absolute; right:0; top:0; height:100%; width:min(86%, 420px);
  background:#fff; padding:12px 12px 12px 12px; overflow:auto;
  box-shadow:-12px 0 24px rgba(0,0,0,.25);
}
.toc .sec{ display:flex; align-items:center; gap:10px; padding:10px 8px; border-radius:10px; border:1px solid #e5e7eb; margin-bottom:8px; }
.toc .idx{ width:28px; height:28px; border-radius:8px; background:var(--brand); color:#fff; font-weight:700; display:flex; align-items:center; justify-content:center; font-size:12px; }
.toc .ttl{ font-size:13px; color:#1f2937; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
.toc .close{ position:absolute; top:10px; right:10px; background:#fff; border:1px solid #e5e7eb; width:36px; height:36px; border-radius:10px; display:flex; align-items:center; justify-content:center; }

/* ラベル色 */
.legend-color{ width:14px; height:14px; border-radius:3px; margin-right:6px; flex:0 0 auto; }
.shock-negative-medium{ text-align:center; background:rgba(229,62,62,0.15); color:#9B2C2C; }
.shock-negative-severe{ text-align:center; background:rgba(229,62,62,0.30); color:#822727; font-weight:600; }
.shock-positive{ text-align:center; background:rgba(72,187,120,0.15); color:#276749; }

